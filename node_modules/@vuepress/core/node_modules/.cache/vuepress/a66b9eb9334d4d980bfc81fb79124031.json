{"remainingRequest":"/Users/imac/Documents/GitHub/@prjdoc/node_modules/babel-loader/lib/index.js??ref--3-1!/Users/imac/Documents/GitHub/@prjdoc/node_modules/vuepress-auth0/dist/routeGuard.js","dependencies":[{"path":"/Users/imac/Documents/GitHub/@prjdoc/node_modules/vuepress-auth0/dist/routeGuard.js","mtime":1590251724526},{"path":"/Users/imac/Documents/GitHub/@prjdoc/node_modules/cache-loader/dist/cjs.js","mtime":1590251710302},{"path":"/Users/imac/Documents/GitHub/@prjdoc/node_modules/babel-loader/lib/index.js","mtime":1590251708855}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubGluayI7Cgp2YXIgX3RoaXMgPSB0aGlzOwoKaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7CmltcG9ydCBVUkkgZnJvbSAndXJpanMnOwppbXBvcnQgQXV0aFNlcnZpY2UgZnJvbSAnLi9hdXRoU2VydmljZSc7Cgp2YXIgaXNDYWxsYmFjayA9IGZ1bmN0aW9uIGlzQ2FsbGJhY2socm91dGUsIGNiVVJMLCBiYXNlKSB7CiAgdmFyIGNiVVJJID0gVVJJKGNiVVJMKTsKICB2YXIgY2JQYXRoID0gY2JVUkkucGF0aCgpOwogIHZhciByb3V0ZUZ1bGxQYXRoID0gVVJJLmpvaW5QYXRocyhiYXNlLCByb3V0ZS5wYXRoKS50b1N0cmluZygpOwogIHJldHVybiBjYlBhdGggPT09IHJvdXRlRnVsbFBhdGg7Cn07Cgp2YXIgcm91dGVHdWFyZCA9IGZ1bmN0aW9uIHJvdXRlR3VhcmQob3B0aW9ucywgc2l0ZURhdGEsIHJvdXRlciwgVnVlKSB7CiAgdmFyIGF1dGhTZXJ2aWNlID0gbmV3IEF1dGhTZXJ2aWNlKG9wdGlvbnMsIHJvdXRlcik7CiAgVnVlLnByb3RvdHlwZS4kYXV0aCA9IGF1dGhTZXJ2aWNlOwogIHZhciBiYXNlID0gc2l0ZURhdGEuYmFzZTsKICB2YXIgbmF2ID0gc2l0ZURhdGEudGhlbWVDb25maWcubmF2OwogIHJldHVybiBmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICAgIHJldHVybiB0c2xpYl8xLl9fYXdhaXRlcihfdGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGF1dGhTdGF0ZSwgbGluaywgbGlua0luZGV4LCByb3V0ZU5lZWRzQXV0aCwgdXNlckhhc01hdGNoaW5nUm9sZXMsIHByb2ZpbGVSb2xlcywgcHJvZmlsZSwgbmF2Q29uZmlnLCBtYXRjaGluZ1JvbGVzLCBtYXRjaGluZ1JvbGVzOwogICAgICByZXR1cm4gdHNsaWJfMS5fX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsKICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJldHVybiBbNCwgYXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCldOwoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgYXV0aFN0YXRlID0gX2Euc2VudCgpOwogICAgICAgICAgICBsaW5rID0gdG8ucGF0aC5yZXBsYWNlKC9cLlteLy5dKyQvLCAiIik7CiAgICAgICAgICAgIGxpbmtJbmRleCA9IG5hdi5maW5kSW5kZXgoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICByZXR1cm4geC5saW5rID09PSBsaW5rOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcm91dGVOZWVkc0F1dGggPSBmYWxzZTsKICAgICAgICAgICAgdXNlckhhc01hdGNoaW5nUm9sZXMgPSB0cnVlOwogICAgICAgICAgICBwcm9maWxlUm9sZXMgPSBbXTsKICAgICAgICAgICAgcmV0dXJuIFs0LCBhdXRoU2VydmljZS5wcm9maWxlXTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHByb2ZpbGUgPSBfYS5zZW50KCk7CgogICAgICAgICAgICBpZiAocHJvZmlsZSAmJiBwcm9maWxlW29wdGlvbnMubmFtZXNwYWNlICsgJ3JvbGVzJ10pIHsKICAgICAgICAgICAgICBwcm9maWxlUm9sZXMgPSBwcm9maWxlW29wdGlvbnMubmFtZXNwYWNlICsgJ3JvbGVzJ107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsaW5rSW5kZXggPiAtMSkgewogICAgICAgICAgICAgIG5hdkNvbmZpZyA9IG5hdltsaW5rSW5kZXhdOwoKICAgICAgICAgICAgICBpZiAobmF2Q29uZmlnLm1ldGEgJiYgbmF2Q29uZmlnLm1ldGEuYXV0aCB8fCBvcHRpb25zLmFsbFJvdXRlcykgewogICAgICAgICAgICAgICAgcm91dGVOZWVkc0F1dGggPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5hbGxSb3V0ZXMgJiYgbmF2Q29uZmlnLm1ldGEucm9sZXMgJiYgbmF2Q29uZmlnLm1ldGEucm9sZXMubGVuZ3RoID4gMCAmJiBwcm9maWxlUm9sZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBtYXRjaGluZ1JvbGVzID0gbmF2Q29uZmlnLm1ldGEucm9sZXMuZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2ZpbGVSb2xlcy5pbmNsdWRlcyh4KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHVzZXJIYXNNYXRjaGluZ1JvbGVzID0gbWF0Y2hpbmdSb2xlcy5sZW5ndGggPiAwID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFsbFJvdXRlcyAmJiBvcHRpb25zLnJvbGVzICYmIG9wdGlvbnMucm9sZXMubGVuZ3RoID4gMCAmJiBwcm9maWxlUm9sZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBtYXRjaGluZ1JvbGVzID0gb3B0aW9ucy5yb2xlcy5maWx0ZXIoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvZmlsZVJvbGVzLmluY2x1ZGVzKHgpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdXNlckhhc01hdGNoaW5nUm9sZXMgPSBtYXRjaGluZ1JvbGVzLmxlbmd0aCA+IDAgPyB0cnVlIDogZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNDYWxsYmFjayh0bywgb3B0aW9ucy5yZWRpcmVjdFVyaSwgYmFzZSkgJiYgIWF1dGhTdGF0ZSkgewogICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghYXV0aFN0YXRlKSB7CiAgICAgICAgICAgICAgaWYgKHJvdXRlTmVlZHNBdXRoKSB7CiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5sb2dpbih7CiAgICAgICAgICAgICAgICAgIHRhcmdldDogdG8ucGF0aAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHVzZXJIYXNNYXRjaGluZ1JvbGVzKSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnVuYXV0aG9yaXplZFJvdXRlKSB7CiAgICAgICAgICAgICAgICAgIHJvdXRlci5wdXNoKG9wdGlvbnMudW5hdXRob3JpemVkUm91dGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcm91dGVyLnB1c2goJy80MDQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBbMl07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH07Cn07CgpleHBvcnQgZGVmYXVsdCByb3V0ZUd1YXJkOw=="},{"version":3,"sources":["/Users/imac/Documents/GitHub/@prjdoc/node_modules/vuepress-auth0/dist/routeGuard.js"],"names":["_this","tslib_1","URI","AuthService","isCallback","route","cbURL","base","cbURI","cbPath","path","routeFullPath","joinPaths","toString","routeGuard","options","siteData","router","Vue","authService","prototype","$auth","nav","themeConfig","to","from","next","__awaiter","authState","link","linkIndex","routeNeedsAuth","userHasMatchingRoles","profileRoles","profile","navConfig","matchingRoles","__generator","_a","label","isAuthenticated","sent","replace","findIndex","x","namespace","meta","auth","allRoutes","roles","length","filter","includes","redirectUri","login","target","unauthorizedRoute","push"],"mappings":"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","sourcesContent":["var _this = this;\nimport * as tslib_1 from \"tslib\";\nimport URI from 'urijs';\nimport AuthService from './authService';\nvar isCallback = function (route, cbURL, base) {\n    var cbURI = URI(cbURL);\n    var cbPath = cbURI.path();\n    var routeFullPath = URI.joinPaths(base, route.path).toString();\n    return cbPath === routeFullPath;\n};\nvar routeGuard = function (options, siteData, router, Vue) {\n    var authService = new AuthService(options, router);\n    Vue.prototype.$auth = authService;\n    var base = siteData.base;\n    var nav = siteData.themeConfig.nav;\n    return function (to, from, next) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var authState, link, linkIndex, routeNeedsAuth, userHasMatchingRoles, profileRoles, profile, navConfig, matchingRoles, matchingRoles;\n        return tslib_1.__generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4, authService.isAuthenticated()];\n                case 1:\n                    authState = _a.sent();\n                    link = to.path.replace(/\\.[^/.]+$/, \"\");\n                    linkIndex = nav.findIndex(function (x) { return x.link === link; });\n                    routeNeedsAuth = false;\n                    userHasMatchingRoles = true;\n                    profileRoles = [];\n                    return [4, authService.profile];\n                case 2:\n                    profile = _a.sent();\n                    if (profile && profile[options.namespace + 'roles']) {\n                        profileRoles = profile[options.namespace + 'roles'];\n                    }\n                    if (linkIndex > -1) {\n                        navConfig = nav[linkIndex];\n                        if ((navConfig.meta && navConfig.meta.auth) || options.allRoutes) {\n                            routeNeedsAuth = true;\n                            if (!options.allRoutes && navConfig.meta.roles && navConfig.meta.roles.length > 0 && profileRoles.length > 0) {\n                                matchingRoles = navConfig.meta.roles.filter(function (x) { return profileRoles.includes(x); });\n                                userHasMatchingRoles = matchingRoles.length > 0 ? true : false;\n                            }\n                            if (options.allRoutes && options.roles && options.roles.length > 0 && profileRoles.length > 0) {\n                                matchingRoles = options.roles.filter(function (x) { return profileRoles.includes(x); });\n                                userHasMatchingRoles = matchingRoles.length > 0 ? true : false;\n                            }\n                        }\n                    }\n                    if (isCallback(to, options.redirectUri, base) && !authState) {\n                        next();\n                    }\n                    else if (!authState) {\n                        if (routeNeedsAuth) {\n                            authService.login({ target: to.path });\n                        }\n                        else {\n                            next();\n                        }\n                    }\n                    else {\n                        if (userHasMatchingRoles) {\n                            next();\n                        }\n                        else {\n                            if (options.unauthorizedRoute) {\n                                router.push(options.unauthorizedRoute);\n                            }\n                            else {\n                                router.push('/404');\n                            }\n                        }\n                    }\n                    return [2];\n            }\n        });\n    }); };\n};\nexport default routeGuard;\n"]}]}